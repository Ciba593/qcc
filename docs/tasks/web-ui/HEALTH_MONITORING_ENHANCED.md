# 健康监控功能增强说明

## 更新日期
2025-10-18

## 增强内容

### 1. 详细状态展示

在健康监控页面中，每个 Endpoint 现在可以**展开查看详细信息**。

#### 主表格增强功能

1. **状态指示器**
   - 添加实时状态徽章（Badge）
   - 绿点 = 健康
   - 黄点 = 降级
   - 红点 = 不健康
   - 灰点 = 未知

2. **可排序字段**
   - 成功率（升序/降序）
   - 平均响应时间（快→慢 / 慢→快）
   - 最后检查时间（最新/最旧）

3. **可筛选字段**
   - 启用状态（已启用/已禁用）

4. **增强的数据展示**
   - **成功率**: 显示百分比数字 + 进度条
   - **响应时间**: 根据速度显示不同颜色
     - <200ms = 绿色（优秀）
     - 200-500ms = 黄色（正常）
     - >500ms = 红色（慢）
   - **请求统计**: 垂直显示总数、失败数、连续失败数

5. **Base URL**: 可点击直接访问

### 2. 可展开的详细信息面板

点击每行的"详情"按钮，展开显示：

#### 详细信息字段

| 字段 | 说明 |
|------|------|
| Endpoint ID | 唯一标识符（代码格式显示） |
| Base URL | 完整 URL（可点击访问） |
| 健康状态 | 状态徽章 + 标签 |
| 启用状态 | 已启用/已禁用标签 |
| 成功率 | 百分比 + 成功数/总数 |
| 平均响应时间 | 格式化时间显示 |
| 总请求数 | 累计请求次数 |
| 失败请求数 | 失败次数（红色高亮） |
| 连续失败次数 | 标签显示（红色警告） |
| 最后检查时间 | 本地化时间格式 |

#### 快捷操作按钮

- **立即测试**: 对当前 Endpoint 执行健康测试
- **查看日志**: 查看详细的请求日志（开发中）

### 3. 分页增强

- **每页显示**: 10 条记录（可调整）
- **显示总数**: "共 X 个 Endpoint"
- **每页大小选择**: 支持切换显示条数

### 4. UI/UX 改进

1. **空状态提示**
   - 显示问号图标
   - 友好的提示文字
   - 引导用户添加 Endpoint

2. **响应式布局**
   - 水平滚动支持（1400px）
   - 操作列固定在右侧

3. **交互优化**
   - Tooltip 提示（鼠标悬停显示完整信息）
   - 加载状态指示
   - 实时数据刷新（10秒间隔）

## 页面截图说明

### 主表格视图
```
┌─────────────────────────────────────────────────────────────────┐
│ 健康监控                          [测试所有 Endpoint] 按钮      │
├─────────────────────────────────────────────────────────────────┤
│ [健康: 5] [降级: 1] [不健康: 2] [未知: 0]                      │
├─────────────────────────────────────────────────────────────────┤
│ Endpoint 健康详情                                               │
│ ┌───────────────────────────────────────────────────────────┐  │
│ │ 状态 │ ID │ URL │ 成功率 │ 响应 │ 请求 │ 检查时间 │ 操作 │  │
│ ├───────────────────────────────────────────────────────────┤  │
│ │ ● ✓ │ 36fb │ api.xx │ 98.5% │ 150ms │ 100 │ 10:30 │ [测试] [详情] │
│ └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

### 展开详情视图
```
┌─────────────────────────────────────────────────────────────────┐
│ 详细信息                                                        │
│ ┌───────────────────────────────────────────────────────────┐  │
│ │ Endpoint ID: 36fb0ed6                                      │  │
│ │ Base URL: https://api.anthropic.com                       │  │
│ │ 健康状态: ● ✓ 健康                                         │  │
│ │ 启用状态: ✓ 已启用                                         │  │
│ │ 成功率: 98.50% (197/200)                                   │  │
│ │ 平均响应时间: 150ms                                        │  │
│ │ 总请求数: 200                                              │  │
│ │ 失败请求数: 3                                              │  │
│ │ 连续失败次数: 0 次                                         │  │
│ │ 最后检查时间: 2025-10-18 10:30:00                         │  │
│ ├───────────────────────────────────────────────────────────┤  │
│ │ [立即测试]  [查看日志]                                     │  │
│ └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 使用指南

### 查看 Endpoint 详细状态

1. 访问健康监控页面: `http://localhost:5174/health`
2. 在表格中找到目标 Endpoint
3. 点击该行右侧的"详情"按钮
4. 展开面板显示完整的状态信息
5. 可在详情面板中直接执行测试

### 排序和筛选

**按成功率排序**:
- 点击"成功率"列标题
- 再次点击切换升序/降序

**按响应时间排序**:
- 点击"平均响应"列标题
- 找出最快/最慢的 Endpoint

**筛选启用状态**:
- 点击"启用状态"列的筛选图标
- 选择"已启用"或"已禁用"

### 快速测试

**单个 Endpoint**:
- 方式 1: 表格中点击"测试"按钮
- 方式 2: 展开详情后点击"立即测试"

**所有 Endpoint**:
- 点击页面右上角"测试所有 Endpoint"

## 技术实现

### 前端组件

**使用的 Ant Design 组件**:
- `Table` - 主表格
- `Descriptions` - 详情展示
- `Badge` - 状态徽章
- `Progress` - 成功率进度条
- `Tag` - 状态标签
- `Tooltip` - 悬停提示

**关键功能**:
```typescript
// 可展开表格
expandable={{
  expandedRowRender: (record) => <详情面板>,
  expandIcon: () => <详情按钮>
}}

// 排序功能
sorter: (a, b) => a.value - b.value

// 筛选功能
filters: [{ text: '已启用', value: true }]
onFilter: (value, record) => record.enabled === value
```

### 数据流

```
用户点击"详情"
    ↓
触发展开动画
    ↓
渲染 Descriptions 组件
    ↓
显示详细字段信息
    ↓
用户可执行操作（测试/查看日志）
```

## 文件变更

### 修改的文件

1. `qcc-web/src/pages/Health.tsx`
   - 添加 `Descriptions` 和 `Badge` 导入
   - 添加 `getStatusBadge()` 函数
   - 增强表格列定义（排序、筛选）
   - 添加 `expandable` 配置
   - 增强 UI 细节

## 后续改进计划

### 短期（v1.1）

1. **查看日志功能**
   - 实现请求日志存储
   - 显示最近 N 条请求记录
   - 支持日志筛选和搜索

2. **复制功能**
   - 点击 Endpoint ID 复制到剪贴板
   - 复制 Base URL

3. **导出功能**
   - 导出健康报告（CSV/JSON）
   - 导出性能数据

### 中期（v1.2）

1. **趋势图表**
   - 响应时间趋势折线图
   - 成功率变化曲线
   - 请求量柱状图

2. **告警配置**
   - 设置健康阈值
   - 自动告警通知
   - 邮件/WebSocket 推送

3. **批量操作**
   - 批量启用/禁用
   - 批量测试选中项

### 长期（v2.0）

1. **实时监控**
   - WebSocket 实时数据推送
   - 实时状态更新动画

2. **智能分析**
   - 异常检测
   - 性能优化建议
   - 自动故障诊断

3. **历史记录**
   - 健康检查历史
   - 性能数据回溯
   - 趋势分析报告

## 测试建议

### 功能测试清单

- [ ] 表格正常显示所有 Endpoint
- [ ] 点击"详情"可展开/收起
- [ ] 详情面板显示完整信息
- [ ] 排序功能正常工作
- [ ] 筛选功能正常工作
- [ ] "立即测试"按钮响应正常
- [ ] 状态徽章颜色正确
- [ ] 响应时间颜色编码正确
- [ ] 空状态提示正确显示
- [ ] 分页功能正常

### 性能测试

- [ ] 100+ Endpoint 加载性能
- [ ] 展开多个详情面板的性能
- [ ] 自动刷新对性能的影响

## 已知问题

1. **查看日志功能**: 当前为占位功能，需要后端支持
2. **大数据量**: 超过 1000 个 Endpoint 时可能需要虚拟滚动优化

## 相关文档

- [健康监控实现文档](./health-monitoring-implementation.md)
- [健康监控使用指南](./HEALTH_MONITORING_DEMO.md)
- [Ant Design Table 文档](https://ant.design/components/table-cn)

## 贡献者

- Claude (AI Assistant)
- 更新日期: 2025-10-18
